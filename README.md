# Image2Video

基于OpenCV和MoviePy的图片转视频工具，支持高质量动画效果和平滑过渡。

## 项目特点

- **高精度动画效果**：使用OpenCV实现的高精度动画效果，完全消除抖动和黑边问题
- **平滑转场**：多种精心设计的转场效果，支持自然平滑的片段衔接
- **多段视频合成**：支持多个视频片段合成，自动处理片段间的转场效果
- **丰富的动画预设**：内置20多种专业级摄像机效果（推、拉、移动、缩放+平移组合等）
- **灵活的动画曲线**：支持10种动画曲线（线性、缓入缓出、弹性、跳跃等）及随机选项
- **直观的用户界面**：基于PyQt6的简洁界面，易于操作
- **音频支持**：可为图片添加配音，自动调整视频长度匹配音频长度
- **高度可定制**：支持自定义转场、动画效果、视频分辨率和输出质量

## 安装步骤

1. 确保已安装Python 3.7+
2. 克隆仓库
   ```
   git clone https://github.com/hugochou/image2video.git
   cd image2video
   ```
3. 创建并激活虚拟环境
   ```
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   venv\Scripts\activate  # Windows
   ```
4. 安装依赖
   ```
   pip install -r requirements.txt
   ```

## 使用方法

1. 运行程序
   ```
   python run.py
   ```
2. 使用界面添加图片
3. 选择动画预设和曲线
4. 点击"生成片段"预览单个图片效果
5. 完成所有图片设置后，点击"生成视频"创建完整视频

## 动画类型

### 基础动画
- **静止**：无任何动画效果
- **缩放-放大**：画面逐渐放大
- **缩放-缩小**：画面逐渐缩小
- **缩放-剧烈**：更明显的放大效果
- **轻微放大/缩小**：微妙的放大/缩小效果
- **脉动**：轻微的呼吸式缩放效果

### 平移动画
- **平移-左到右**：画面从左向右移动
- **平移-右到左**：画面从右向左移动
- **平移-上到下**：画面从上向下移动
- **平移-下到上**：画面从下向上移动
- **轻微左右/上下**：更微妙的平移效果
- **对角线移动**：多种对角线方向的移动

### 组合动画
- **缩放+平移** (8种组合)：同时进行缩放和平移，包括左右、上下和对角线方向
- **缩小+平移** (2种组合)：同时进行缩小和平移
- **跳动**：带有轻微弹跳效果的动画

## 动画曲线

- **线性**：匀速变化
- **缓入**：从慢到快
- **缓出**：从快到慢
- **缓入缓出**：先慢后快再慢
- **强缓入**：更强烈的缓入效果
- **强缓出**：更明显的缓出效果
- **平滑弹入**：带有弹性的进入效果
- **平滑弹出**：带有弹性的退出效果
- **随机**：随机选择以上任一曲线

## 转场效果

### 基本转场
- **淡入淡出**：两个场景之间的平滑溶解过渡
- **滑动** (多方向)：新场景从指定方向滑入
- **交叉淡入淡出**：两个场景交叉溶解

### 高级转场
- **旋转淡入**：新场景旋转进入
- **缩放淡入**：新场景缩放进入
- **扭曲溶解**：带有波浪扭曲效果的溶解
- **百叶窗**：像百叶窗一样逐渐显示新场景
- **闪白过渡**：通过闪白效果过渡到新场景
- **无**：无转场效果
- **随机**：随机选择一种转场效果

## 视频合成选项

- **自定义转场序列**：为每个片段交接处单独设置转场效果
- **转场时长调整**：自定义转场效果的持续时间
- **输出分辨率**：支持自定义输出视频的分辨率
- **输出质量**：支持低、中、高三种质量预设

## 技术实现

### 动画引擎
项目使用OpenCV实现高精度图像变换，通过以下技术确保动画效果的平滑和精确：

1. **仿射变换矩阵**：精确控制图像的缩放和平移
2. **边缘填充算法**：智能处理图像边缘，避免黑边
3. **曲线函数**：使用数学曲线函数精确控制动画进度
4. **过采样技术**：使用3倍采样率减少抖动
5. **边缘反射填充**：使用`BORDER_REFLECT`模式处理边缘像素

### 转场系统
转场效果基于OpenCV的帧处理实现，确保两个片段之间的平滑衔接：

1. **帧混合算法**：使用前一片段的最后帧和后一片段的首帧进行平滑过渡
2. **自定义转场**：支持为每个衔接点指定不同的转场效果
3. **随机模式**：支持随机选择转场效果，增加视频变化
4. **特效渲染**：使用OpenCV实现各种视觉特效转场

### 音频处理
项目自动处理音频与视频的同步问题：

1. **自动延长**：当音频长度超过视频时，自动延长视频以匹配音频
2. **音频循环**：当视频长度超过音频时，可选择循环播放音频
3. **音频混合**：确保转场过程中音频平滑过渡

## 项目架构

项目采用模块化设计，主要分为以下几个服务：

1. **VideoService**：负责视频创建、片段生成和最终合成
2. **AnimationService**：专门处理动画效果，包含预设和曲线实现
3. **TransitionService**：处理转场效果，提供多种转场选择
4. **AudioService**：负责音频处理和语音生成

## 系统要求
- Python 3.7 或更高版本
- 操作系统：Windows/macOS/Linux
- OpenCV-Python (用于高精度图像处理)
- MoviePy (用于视频合成)
- PyQt6 (用于用户界面)

## 当前状态

### 已完成
- [x] 高精度OpenCV动画系统
- [x] 多种动画预设和曲线
- [x] 高质量转场效果
- [x] 音频与视频同步
- [x] 用户界面
- [x] 完整的视频导出流程
- [x] 多段视频合成
- [x] 自定义转场序列
- [x] 自定义输出质量和分辨率

### 计划中
- [ ] 更多的动画预设
- [ ] 支持3D转场效果
- [ ] 批量处理功能
- [ ] 增加文本标题和字幕支持
- [ ] 支持视频片段输入

## 使用示例

1. 创建简单的图片幻灯片：
   - 添加多张图片
   - 选择"缩放-放大"动画和"缓入缓出"曲线
   - 使用"淡入淡出"转场
   - 生成平滑过渡的视频

2. 创建专业视频展示：
   - 添加高分辨率图片
   - 为每张图片选择不同的动画效果和曲线
   - 为每个转场点选择不同的转场效果
   - 添加配音
   - 导出高质量视频

## 贡献
欢迎提交Pull Request或Issue。

## 许可
本项目遵循MIT许可证。

## 技术细节

项目使用OpenCV进行高精度图像变换，通过仿射变换矩阵实现平滑过渡，避免了传统帧间插值导致的抖动问题。动画参数通过数学曲线函数精确计算，确保每一帧的位置和缩放精确无误。

## 功能特点

1. **图片上传与管理**
   - 支持批量上传图片
   - 为每张图片添加对应的文本描述
   - 支持图片预览和排序
   - 支持删除和编辑功能

2. **文本转语音**
   - 支持文本转换为语音
   - 支持语音预览
   - 支持语音参数调整（语速、音调等）

3. **视频生成**
   - 自动将图片和语音合成为视频
   - 支持多种过渡效果（淡入淡出、滑动、缩放等）
   - 支持多种动画效果（推、拉、平移、环绕等）
   - 支持自定义动画曲线（线性、缓入、缓出、弹性等）
   - 支持视频预览
   - 支持导出不同格式和分辨率

## 技术架构

- 开发语言：Python 3.8+
- GUI框架：PyQt6
- 视频处理：MoviePy
- 图像处理：Pillow
- 网络请求：requests
- 数据持久化：JSON

## 界面设计

1. **主界面（图片管理）**
   - 左侧：图片列表，支持拖拽排序
   - 右侧：图片预览和文本编辑区
   - 顶部：工具栏（上传、删除、导出等）
   - 底部：状态栏（显示处理进度）

2. **视频设置界面**
   - 动画效果选择
   - 过渡效果选择
   - 动画曲线选择
   - 视频参数配置（分辨率、帧率等）

3. **视频预览界面**
   - 视频播放器
   - 导出选项
   - 进度显示

## 项目状态

### 已完成功能
- [x] 创建项目基础结构
- [x] 实现主界面布局
- [x] 实现图片上传和预览功能
- [x] 实现视频生成功能
- [x] 实现多种动画效果
- [x] 实现多种过渡效果
- [x] 实现自定义动画曲线
- [x] 实现视频预览功能

### 待完成功能
- [ ] 优化用户界面和交互体验
- [ ] 添加更多视频导出选项
- [ ] 添加批量处理功能
- [ ] 添加更多动画效果
- [ ] 添加更多过渡效果

## 使用说明

1. 启动应用：
   ```bash
   python run.py
   ```

2. 添加图片：
   - 点击"添加图片"按钮或拖拽图片到应用窗口
   - 为每张图片添加描述文本

3. 设置视频效果：
   - 选择动画效果（推、拉、平移等）
   - 选择过渡效果（淡入淡出、滑动等）
   - 选择动画曲线（线性、缓入、缓出等）

4. 生成视频：
   - 点击"生成视频"按钮
   - 等待处理完成
   - 预览生成的视频
   - 导出到指定位置

## 系统要求
- Python 3.8 或更高版本
- 操作系统：Windows/macOS/Linux
- 网络连接（用于API调用）

## 开发环境设置
1. 克隆项目
2. 创建虚拟环境：
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/macOS
   # 或
   .\venv\Scripts\activate  # Windows
   ```
3. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
4. 运行应用：
   ```bash
   python run.py
   ```

## 项目结构
```
image2video/
├── run.py                  # 应用入口
├── requirements.txt        # 项目依赖
├── src/
│   ├── ui/                # UI相关代码
│   │   ├── main_window.py
│   │   └── video_preview.py
│   ├── models/            # 数据模型
│   │   └── image_item.py
│   ├── services/          # 业务逻辑
│   │   ├── audio_service.py
│   │   └── video_service.py
│   └── utils/             # 工具函数
├── resources/             # 资源文件
├── audio/                 # 音频文件目录
└── output/                # 输出视频目录
```

## 注意事项
- 视频生成可能需要较长时间，取决于图片数量和分辨率
- 建议使用高速网络连接
- 确保有足够的磁盘空间用于视频生成 